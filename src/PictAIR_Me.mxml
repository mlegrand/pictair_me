<?xml version="1.0" encoding="utf-8"?>
<WindowedApplication xmlns="http://ns.adobe.com/mxml/2009" xmlns:view="com.pnwrain.pictair_me.view.*"
	title="Picture_Me {applicationManager.appVersion}"
	layout="absolute"
	width="640"
	height="700"
	horizontalScrollPolicy="off"
	verticalScrollPolicy="off"
	creationComplete="onCreationComplete()" >
	
	<Script>
		<![CDATA[
			import mx.core.UIComponent;
			import flash.filters.ShaderFilter;
			import flash.utils.ByteArray;
			import mx.collections.ArrayCollection;
			import com.pnwrain.pictair_me.business.FilterManager;
			import com.pnwrain.pictair_me.business.PictureManager;
			import com.pnwrain.pictair_me.business.ApplicationManager;
			
			[Bindable]
			private var filterManager:FilterManager;
			private var pictureManager:PictureManager;
			[Bindable]
			private var applicationManager:ApplicationManager;
			
			[Bindable]
			private var pictures:ArrayCollection;
			
			private function onCreationComplete():void {
				filterManager = new FilterManager();
				pictureManager = new PictureManager();
				applicationManager = new ApplicationManager();
				pictures = new ArrayCollection( pictureManager.loadPictures() );
			}
		
			private function loadFilter(event:Event):void {
				vd.filters = filterManager.getFilter(event.target.selectedItem);
			}
			
			private function takePicture():void {
				timer.visible = false;
				pictures.addItem(pictureManager.savePicture(vd));
			}
		]]>
	</Script>
	<view:VideoDisplay id="vd" width="640" height="480" />
	<view:CountDownTimer id="timer" skinClass="{com.pnwrain.pictair_me.skin.CountDownTimerSkin}" horizontalCenter="0" top="380" visible="false"
		countDownStart="timer.visible=true" countDownCancel="timer.visible=false" countDownEnd="takePicture();"  />

	<ApplicationControlBar top="480" width="100%" dock="false" >
		<Canvas width="100%" height="100%">
			<FxButton click="timer.countDown()" skinClass="com.pnwrain.pictair_me.skin.CameraButtonSkin" height="50" width="50" horizontalCenter="0" verticalCenter="0"/>
			<ComboBox dataProvider="{filterManager.filters}" labelField="name" verticalCenter="0" right="10" change="loadFilter(event)"/>
		</Canvas>
	</ApplicationControlBar>
	<HBox bottom="0" width="100%" height="140" horizontalGap="0">
		<FxButton height="100%" width="20" />
		<HorizontalList width="100%" height="140"  dataProvider="{pictures}" itemRenderer="com.pnwrain.pictair_me.view.ImageThumbnail" horizontalScrollPolicy="off" />
		<FxButton height="100%" width="20" label="" />
	</HBox>
	
</WindowedApplication>
